name: W3C-DID
on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  test-units:
    runs-on: ubuntu-latest
    name: ğŸ§ª test-units
    steps:
      - name: ğŸ›ï¸ Checkout
        uses: actions/checkout@v3
        with:
          submodules: 'true'
      - name: â¬ Install Zenroom
        run: |
          wget https://github.com/dyne/zenroom/releases/latest/download/zenroom -O zenroom
          chmod +x zenroom
          cp zenroom test/
      - name: ğŸ§ª Run tests
        run: |
          make test-units

  restroom_job:
    runs-on: ubuntu-latest
    name: ğŸ”¬ restroom tests
    steps:
      - name: ğŸ›ï¸ Checkout
        uses: actions/checkout@v3
        with:
          submodules: 'true'
      - name: â¬ Install Zenroom
        run: |
          wget https://github.com/dyne/zenroom/releases/latest/download/zenroom -O zenroom
          chmod +x zenroom
      - name: â¬ Install restroom-test
        run: |
          wget https://github.com/dyne/zencode-tools/releases/latest/download/restroom-test -O restroom-test
          chmod +x restroom-test
      - name: ğŸ›« Start restroom
        uses: dyne/restroom-github-action@v1
        with:
          restroom-contracts: "${{ github.workspace }}/api"
          restroom-files: "${{ github.workspace }}/"
      - name: ğŸ§ª Run tests
        run: ./test/run.sh
