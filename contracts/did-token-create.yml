zenchain: 1.0
start: did-token-create-1.zen
blocks:
  did-token-create-1.zen:
    zenContent: |-
      Given I have a 'string array' named 'keypairs'

      Then print 'keypairs'
    keysFile: did-token-create-1.keys
    next: did-token-create-2-keypair.zen
  did-token-create-2-keypair.zen:
    forEach: keypairs
    index: temp
    zenContent: |
      Scenario 'eddsa': Generate keypair

      Given I have a 'string' named 'temp'
      When I remove 'temp'
      When I create the eddsa key
      When I create the eddsa public key
      # if codec==keyring and name != keyring then it will not be printed
      # this is used to overcome this limitation
      When I create the 'base58 dictionary'
      When I move 'eddsa' from 'keyring' to 'base58 dictionary'
      When I pickup from path 'base58_dictionary.eddsa'

      Then print the 'eddsa public key'
      Then print the 'eddsa'
    next: did-token-create-3-pksk.zen
  did-token-create-3-pksk.zen:
    forEach: keypairs
    index: temp
    zenContent: |-
      Rule caller restroom-mw
      Scenario 'eddsa': keypairs

      Given I have a valid redis connection on 'redis://localhost:6379'

      Given I have a 'string' named 'eddsa' in 'temp'
      Given I have a 'string' named 'eddsa public key' in 'temp'

      When I set 'token' to 'tokens:' as 'string'
      When I append 'eddsa_public_key' to 'token'
      Then print the 'token'
      Then print the 'eddsa'

      Then I write 'eddsa' into redis under the key named by 'token'
