zenchain: 1.0
start: did-faucet-1-select-token.zen
blocks:
  did-faucet-1-select-token.zen:
    zenContent: |
      Rule caller restroom-mw

      Given I have a valid redis connection on 'redis://localhost:6379'
      Given I read into 'token_sent' and increment the key named by 'key'

      Given I have a 'string' named 'token_sent'

      When I set 'token:' to 'token:' as 'string'
      When I append 'token_sent' to 'token:'

      Then print the 'token:'
    keysFile: did-faucet-1-select-token.keys
    next: did-faucet-2-sent.zen
  did-faucet-2-sent.zen:
    zenContent: >
      Rule caller restroom-mw


      Given I have a valid redis connection on 'redis://localhost:6379'

      Given I read from redis the data under the key 'token:' and save the
      output into 'token'


      Given I have a 'string dictionary' named 'token'


      When I set 'sent:' to 'sent:' as 'string'

      When I pickup from path 'token.eddsa_public_key'

      When I append 'eddsa_public_key' to 'sent:'


      Then print the 'token'

      Then print 'sent:'


      Then I remove the key 'token:' in redis

      Then I write 'token' into redis under the key named by 'sent:'
